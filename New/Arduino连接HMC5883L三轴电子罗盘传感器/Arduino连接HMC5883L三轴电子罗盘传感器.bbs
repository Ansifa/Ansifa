<P align=center><BR><STRONG><FONT size=4>Arduino连接HMC5883L三轴电子罗盘传感器 </FONT></STRONG></P><BR>用途：测量地磁方向，测量物体静止时候的方向，测量传感器周围磁力线的方向。注意，测量地磁时候容易受到周围磁场影响，<BR><BR>主芯片HMC5883三轴磁阻传感器特点（抄自网上）： <BR>1，数字量输出：I2C数字量输出接口，设计使用非常方便。 <BR>2，尺寸小: 3x3x0.9mm LCC封装，适合大规模量产使用。<BR>3，精度高：1－2度，内置12位A/D,OFFSET, SET/RESET 电路，不会出现磁饱和现象，不会有累加误差。 <BR>4，支持自动校准程序，简化使用步骤，终端产品使用非常方便。 <BR>5，内置自测试电路，方便量产测试，无需增加额外昂贵的测试设备。 <BR>6，功耗低：供电电压1.8V, 功耗睡眠模式-2.5uA 测量模式-0.6mA<BR><BR>连接方法：<BR>只要连接VCC，GND，SDA，SDL四条线。
<LI>Arduino GND -&gt; HMC5883L GND</LI>
<LI>Arduino 3.3V -&gt; HMC5883L VCC</LI>
<LI>Arduino A4 (SDA) -&gt; HMC5883L SDA</LI>
<LI>Arduino A5 (SCL) -&gt; HMC5883L SCL<BR><BR>(注意，接线是A4，A5，不是D4,D5)<BR><BR><BR><BR>程序编写：</LI>
<OL type=1>
<LI>下载HMC5883L库文件。下载地址：<A href="http://soft2.wmzhe.com/download/AnsifaArduino/HMC5883L.zip">http://soft2.wmzhe.com/download/AnsifaArduino/HMC5883L.zip</A></LI>
<LI>解压HMC5883L库文件到arduino文件夹：arduino-0022\libraries下面。</LI>
<LI>编写以下程序，下载下面测试程序到arduino：</LI></OL>[quote] <BR>#include&nbsp;&lt;<FONT color=#cc6600>Wire</FONT>.h&gt; <BR>#include&nbsp;&lt;<FONT color=#cc6600>HMC5883L</FONT>.h&gt; <BR><FONT color=#cc6600>HMC5883L</FONT> compass; <BR><FONT color=#cc6600>void</FONT> <FONT color=#cc6600><STRONG>setup</STRONG></FONT>() <BR>{ <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>begin</FONT>(9600); <BR>&nbsp;&nbsp;<FONT color=#cc6600>Wire</FONT>.<FONT color=#cc6600>begin</FONT>(); <BR>&nbsp;&nbsp;compass&nbsp;=&nbsp;<FONT color=#cc6600>HMC5883L</FONT>(); <BR>&nbsp;&nbsp;compass.<FONT color=#cc6600>SetScale</FONT>(1.3); <BR>&nbsp;&nbsp;compass.<FONT color=#cc6600>SetMeasurementMode</FONT>(<FONT color=#006699>Measurement_Continuous</FONT>); <BR>} <BR><FONT color=#cc6600>void</FONT> <FONT color=#cc6600><STRONG>loop</STRONG></FONT>() <BR>{ <BR>&nbsp;&nbsp;<FONT color=#cc6600>MagnetometerRaw</FONT> raw = compass.<FONT color=#cc6600>ReadRawAxis</FONT>(); <BR>&nbsp;&nbsp;<FONT color=#cc6600>MagnetometerScaled</FONT> scaled = compass.<FONT color=#cc6600>ReadScaledAxis</FONT>(); <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> xHeading = <FONT color=#cc6600>atan2</FONT>(scaled.<FONT color=#cc6600>YAxis</FONT>, scaled.<FONT color=#cc6600>XAxis</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> yHeading = <FONT color=#cc6600>atan2</FONT>(scaled.<FONT color=#cc6600>ZAxis</FONT>, scaled.<FONT color=#cc6600>XAxis</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> zHeading = <FONT color=#cc6600>atan2</FONT>(scaled.<FONT color=#cc6600>ZAxis</FONT>, scaled.<FONT color=#cc6600>YAxis</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(xHeading &lt; 0) xHeading += 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(xHeading &gt; 2*<FONT color=#006699>PI</FONT>) xHeading -= 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(yHeading &lt; 0) yHeading += 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(yHeading &gt; 2*<FONT color=#006699>PI</FONT>) yHeading -= 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(zHeading &lt; 0) zHeading += 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>if</FONT>(zHeading &gt; 2*<FONT color=#006699>PI</FONT>) zHeading -= 2*<FONT color=#006699>PI</FONT>; <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> xDegrees = xHeading * 180/M_PI; <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> yDegrees = yHeading * 180/M_PI; <BR>&nbsp;&nbsp;<FONT color=#cc6600>float</FONT> zDegrees = zHeading * 180/M_PI; <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>print</FONT>(xDegrees); <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>print</FONT>(<FONT color=#006699>","</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>print</FONT>(yDegrees); <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>print</FONT>(<FONT color=#006699>","</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>print</FONT>(zDegrees); <BR>&nbsp;&nbsp;<FONT color=#cc6600><STRONG>Serial</STRONG></FONT>.<FONT color=#cc6600>println</FONT>(<FONT color=#006699>";"</FONT>); <BR>&nbsp;&nbsp;<FONT color=#cc6600>delay</FONT>(100); <BR>} <BR>[/quote]